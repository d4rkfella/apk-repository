package:
  name: libplacebo
  version: "7.349.0"
  epoch: 0
  description: Reusable library for GPU-accelerated video/image rendering
  copyright:
    - license: LGPL-2.1-or-later
environment:
  contents:
    packages:
      - build-base
      - busybox
      - shaderc
      - lcms2-dev
      - vulkan-loader
      - libdovi-dev
      - py3-mako
pipeline:
  - uses: git-checkout
    with:
      repository: https://code.videolan.org/videolan/libplacebo
      tag: v${{package.version}}
      expected-commit: 1fd3c7bde7b943fe8985c893310b5269a09b46c5
      recurse-submodules: true
  - runs: |
      export CFLAGS="$CFLAGS -O2"
      export CXXFLAGS="$CXXFLAGS -O2"
      apk add glslang-dev glslang-static --no-cache
  - uses: meson/configure
    with:
      opts: |
      --buildtype=plain \
      --bindir=/usr/bin \
      --buildtype=plain \
      --datadir=/usr/share \
      --includedir=/usr/include \
      --infodir=/usr/share/info \
      --libdir=/usr/lib \
      --libexecdir=/usr/libexec \
      --localedir=/usr/share/locale \
      --localstatedir=/var \
      --mandir=/usr/share/man \
      --prefix=/usr \
      --sbindir=/usr/sbin \
      --sharedstatedir=/var/lib \
      --sysconfdir=/etc \
      --python.bytecompile=0 \
      --werror=false \
      -Db_lto=true \
      -Dbackend_max_links=4 \
      -Dglslang=enabled \
      -Dtests=false \
      -Ddemos=false \
      -Ddovi=enabled \
      -Dlcms=enabled \
      -Dlibdovi=enabled \
      -Dshaderc=enabled \
      -Dvulkan=enabled \
      -Ddefault_library=both

  - uses: meson/compile
 
  - uses: meson/install

  - uses: strip

subpackages:
  - name: ${{package.name}}-dev
    pipeline:
      - uses: split/dev
    test:
      pipeline:
        - uses: test/pkgconf
        - uses: test/tw/ldd-check
          with:
            packages: ${{package.name}}-dev
  
  - name: ${{package.name}}-doc
    description: ${{package.name}} documentation
    pipeline:
      - uses: split/manpages
      - uses: split/infodir

test:
  pipeline:
    - uses: test/tw/ldd-check
