package:
  name: libplacebo
  version: "7.349.0"
  epoch: 0
  description: Reusable library for GPU-accelerated video/image rendering
  copyright:
    - license: LGPL-2.1-or-later
environment:
  contents:
    packages:
      - build-base
      - busybox
      - shaderc
      - lcms2-dev
      - vulkan-loader
      - libdovi-dev
pipeline:
  - uses: git-checkout
    with:
      repository: https://code.videolan.org/videolan/libplacebo
      tag: v${{package.version}}
      expected-commit: 1fd3c7bde7b943fe8985c893310b5269a09b46c5
      recurse-submodules: true

  - uses: meson/configure
    with:
      opts: |
        --buildtype=plain \
        --sysconfdir=/etc \
        --localstatedir=/var \
        --libdir=lib \
        -Dtests=false \
        -Ddemos=false \
        -Ddovi=enabled \
        -Dlcms=enabled \
        -Dlibdovi=enabled \
        -Dshaderc=enabled \
        -Dvulkan=enabled

  - uses: meson/compile
 
  - uses: meson/install

  - uses: strip

subpackages:
  - name: ${{package.name}}-dev
    pipeline:
      - uses: split/dev
    test:
      pipeline:
        - uses: test/pkgconf
        - uses: test/tw/ldd-check
          with:
            packages: ${{package.name}}-dev
  
  - name: ${{package.name}}-doc
    description: ${{package.name}} documentation
    pipeline:
      - uses: split/manpages
      - uses: split/infodir

test:
  pipeline:
    - uses: test/tw/ldd-check
