package:
  name: vw_web_vault
  version: 2025.12.0
  epoch: 0
  description: "Web vault for vaultwarden"
  copyright:
    - license: GPL-3.0-only
environment:
  environment:
      REPRODUCIBLE: false
      VAULT_VERSION: v${{package.version}}
      CHECKOUT_TAGS: false
  contents:
    packages:
      - wolfi-base
      - bash
      - build-base
      - nodejs-22
      - npm
      - python-3.14
pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/dani-garcia/bw_web_builds
      tag: v${{package.version}}
      expected-commit: 678e04b0264afdee9c5ed00ace65318225e92c4d
      destination: bw_web_builds
  - name: build-web-vault
    working-directory: /home/build/bw_web_builds
    runs: |
      make checkout
      cd web_vault
      npm ci
      cd apps/web
      npm run dist:oss:selfhost
      printf '{"version":"%s"}\n' "${VAULT_VERSION}" > vw-version.json
  - name: package-installation
    working-directory: /home/build/bw_web_builds/apps/web/build
    runs: |
      mkdir -p ${{targets.destdir}}/usr/lib/vw_web_vault
      cp -r ./* ${{targets.destdir}}/usr/lib/vw_web_vault
update:
  enabled: true
  github:
    identifier: dani-garcia/bw_web_builds
    strip-prefix: v
