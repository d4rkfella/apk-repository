package:
  name: dragonfly
  version: "1.28.0"
  epoch: 0
  description: Dragonfly is an in-memory data store built for modern application workloads.
  copyright:
    - license: BUSL-1.1
environment:
  contents:
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    repositories:
      - https://packages.wolfi.dev/os
    packages:
      - build-base
      - busybox
      - bash
      - glibc-dev
      - boost-dev
      - openssl-dev
      - libtool
      - samurai
      - libunwind-dev
      - bison
      - zlib-dev
      - cmake
      - patch
      - pcre2-dev
      - re2-dev
      - autoconf
      - automake
pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/dragonflydb/dragonfly
      tag: v${{package.version}}
      expected-commit: 51f400ac4a4bbd5ddd88662f1178c4dff67fa74c
      recurse-submodules: true
  - runs: |
      ./helio/blaze.sh -release -DCMAKE_CXX_FLAGS="-flto -ffat-lto-objects" -DCMAKE_MAKE_PROGRAM=/usr/bin/ninja
      cd build-opt
      ninja dragonfly
