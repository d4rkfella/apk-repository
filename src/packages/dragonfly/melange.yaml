package:
  name: dragonfly
  version: "1.28.0"
  epoch: 0
  description: Dragonfly is an in-memory data store built for modern application workloads.
  copyright:
    - license: BUSL-1.1
environment:
  contents:
    keyring:
      - https://packages.darkfellanetwork.com/melange.rsa.pub
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    repositories:
      - https://packages.darkfellanetwork.com
      - https://packages.wolfi.dev/os
    packages:
      - busybox
      - bash
      - build-base
      - boost-dev
      - openssl-dev
      - libtool
      - samurai
      - libunwind-dev
      - bison
      - zlib-dev
      - cmake
      - patch
      - pcre2-dev
      - re2-dev
      - autoconf-archive
      - llvm
      - autoconf
      - automake
pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/dragonflydb/dragonfly
      tag: v${{package.version}}
      expected-commit: 51f400ac4a4bbd5ddd88662f1178c4dff67fa74c
      recurse-submodules: true
  - runs: |
      ./helio/blaze.sh -release --log-level=DEBUG -DCMAKE_CXX_FLAGS="-flto -ffat-lto-objects -fdelete-null-pointer-checks"
      cd build-opt
      ninja dragonfly
