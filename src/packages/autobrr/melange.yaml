package:
  name: autobrr
  version: "1.60.0"
  epoch: 0
  description: "Autobrr redefines download automation for torrents and Usenet, drawing inspiration from tools like trackarr, autodl-irssi, and flexget. We've combined the best of these worlds into one versatile tool that can do it all, and then some."
  copyright:
    - license: GPLv2-or-later
environment:
  contents:
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    repositories:
      - https://packages.wolfi.dev/os
    packages:
      - ca-certificates-bundle
      - nodejs-20
      - corepack
      - go-1.23
      - git
      - build-base
      - tzdata
      - busybox
pipeline:
  - uses: fetch
    with:
      uri: https://github.com/autobrr/autobrr/archive/refs/tags/v${{package.version}}.tar.gz
      expected-sha256: 7915aa4d7fd9b4fe596cb7d284c3b13d9b8a068c7f87caa53ff2c8b47f2f7c59
  - runs: |
      corepack enable
      cd web
      pnpm install --frozen-lockfile
      pnpm run build
  - runs: |
      mkdir -p ${{targets.destdir}}/usr/bin
      cp go.mod go.sum src
      cd src && go mod download
      cp -R web src/
      cd ..
      go build -ldflags "-s -w" -o ${{targets.destdir}}/usr/bin/autobrr cmd/autobrr/main.go
      go build -ldflags "-s -w" -o ${{targets.destdir}}/usr/bin/autobrrctl cmd/autobrrctl/main.go
