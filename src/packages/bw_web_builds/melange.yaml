package:
  name: vw_web_vault
  version: "2025.7.0"
  epoch: 0
  description: "Web vault for vaultwarden"
  copyright:
    - license: GPL-3.0-only

environment:
  environment:
      REPRODUCIBLE: false
      VAULT_VERSION: v${{package.version}}
  contents:
    packages:
      - wolfi-base
      - bash
      - build-base
      - nodejs-22
      - npm
      - python-3.14

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/dani-garcia/bw_web_builds
      tag: v${{package.version}}
      expected-commit: 824b793b415897b79ff8d46fa561eff7b57f76d0
      destination: bw_web_builds
  
  - name: build-web-vault
    working-directory: /home/build/bw_web_builds
    runs: |
      export CHECKOUT_TAGS=false
      make checkout
      make build

  - name: package-installation
    working-directory: /home/build/bw_web_builds/web-vault/apps/web/build
    runs: |
      mkdir -p ${{targets.destdir}}/usr/lib/vw_web_vault
      cp -r ./* ${{targets.destdir}}/usr/lib/vw_web_vault
      sed -i "s|\"version\":\"[^\"]*\"|\"version\":\"${VAULT_VERSION}\"|" "/usr/lib/vw_web_vault/vw-version.json"
