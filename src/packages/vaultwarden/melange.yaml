package:
  name: vaultwarden
  version: "1.35.2"
  epoch: 0
  description: "Unofficial Bitwarden compatible server written in Rust (glibc)"
  copyright:
    - license: GPL-3.0-or-later
  dependencies:
    runtime:
      - wolfi-base
      - ca-certificates
      - openssl
      - libpq-18
      - vw_web_vault
      - curl
environment:
  environment:
    FEATURES: "postgresql"
  contents:
    packages:
      - wolfi-base
      - cargo-auditable
      - pkgconf
      - clang
      - rust
      - curl
      - openssl-dev
      - postgresql-dev
      - zlib-dev
pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/dani-garcia/vaultwarden
      tag: ${{package.version}}
      expected-commit: 4352fffeec7915e45559b46dce18640a25f46801
      destination: vaultwarden
  - name: build-vaultwarden
    working-directory: /home/build/vaultwarden
    runs: |
      cargo auditable build \
        --features ${FEATURES} \
        --release \
        --target ${{build.arch}}-unknown-linux-gnu \
        --bin vaultwarden
  - name: prepare-package
    runs: |
      mkdir -p ${{targets.destdir}}/usr/bin
      cp /home/build/vaultwarden/target/${{build.arch}}-unknown-linux-gnu/release/vaultwarden ${{targets.destdir}}/usr/bin/vaultwarden
      install -m555 -D start.sh ${{targets.destdir}}/usr/bin/start.sh
update:
  enabled: true
  github:
    identifier: dani-garcia/vaultwarden
    strip-prefix: v
