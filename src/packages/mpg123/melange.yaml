package:
  name: libmpg123
  version: "1.32.10"
  epoch: 0
  description: Console-based MPEG Audio Player for Layers 1, 2 and 3
  copyright:
    - license: LGPL-2.1-only
environment:
  contents:
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    repositories:
      - https://packages.wolfi.dev/os
    packages:
      - build-base
pipeline:
  - uses: fetch
    with:
      uri: https://www.mpg123.org/download/mpg123-${{package.version}}.tar.bz2
      expected-sha512: 4df3e76cafe642b1df8befaff3d3530150c13446ca7f07b8d527af5b6522e4d2dedd025a3f095f23a51e2318d17e1395de6e55c70e3a90f80017ea0955fe8c1f

  - uses: autoconf/configure
    with:
      opts: |
        --enable-static \
        --enable-shared \
        --enable-lfs-alias
  
  - uses: autoconf/make
 
  - uses: autoconf/make-install

  - uses: strip
  
subpackages:
  - name: ${{package.name}}-static
    description: ${{package.name}} static library
    pipeline:
      - uses: split/static
  
  - name: ${{package.name}}-utils
    description: ${{package.name}} utils
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/share
          mv ${{targets.destdir}}/usr/bin ${{targets.subpkgdir}}/usr/
    test:
      pipeline:
        - runs: |
            mpg123 --version
            mpg123 --help
            mpg123-strip --version
            mpg123-strip --help
            out123 --version
            out123 --help
            mpg123-id3dump --version
            mpg123-id3dump --help
  
  - name: ${{package.name}}-doc
    description: ${{package.name}} documentation
    pipeline:
      - uses: split/manpages
      - uses: split/infodir
  
  - name: ${{package.name}}-dev
    description: ${{package.name}} dev
    dependencies:
      runtime:
        - ${{package.name}}
        - ${{package.name}}-static
    pipeline:
      - uses: split/dev
    test:
      pipeline:
        - uses: test/pkgconf
        - uses: test/tw/ldd-check
          with:
            packages: ${{package.name}}-dev

test:
  pipeline:
    - uses: test/tw/ldd-check
