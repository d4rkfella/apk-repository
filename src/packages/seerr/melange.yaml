package:
  name: seerr
  version: 2.7.3
  epoch: 0
  description: Open-source media request and discovery manager for Jellyfin, Plex, and Emby.
  copyright:
    - license: MIT
  dependencies:
    runtime:
      - nodejs-23
environment:
  environment:
    REPRODUCIBLE: false
  contents:
    packages:
      - wolfi-baselayout
      - nodejs-23
      - pnpm
      - patch
pipeline:
  - uses: git-checkout
    with:
      expected-commit: e842036fafc9818ea38d2e19d4adb66e17e2aebf
      repository: https://github.com/seerr-team/seerr
      tag: v${{package.version}}
      destination: seerr
  - name: Build
    working-directory: /home/build/seerr
    runs: |
      export NEXT_TELEMETRY_DISABLED=1
      export CYPRESS_INSTALL_BINARY=0
      patch -Np1 -i "../seerr.patch"
      sed -i 's/husky install//' package.json
      pnpm install --frozen-lockfile
      pnpm build
      pnpm prune --prod --ignore-scripts
  - name: Delete linux-musl node-modules
    working-directory: /home/build/seerr
    runs: |
      find node_modules -type d \
        -name "*musl*" \
        -print \
        -exec rm -rf {} + \
        -prune
  - name: Prepare package
    working-directory: /home/build/seerr
    runs: |
      mkdir -p "${{targets.destdir}}/usr/lib/seerr"
      rm -rf .next/cache
      echo "{\"commitTag\": \"$(git rev-parse HEAD)\"}" > committag.json
      cp -af jellyseerr-api.yml package.json committag.json .next dist node_modules "${{targets.destdir}}/usr/lib/seerr"
test:
  environment:
    contents:
      packages:
        - curl
        - bash
        - jq
  pipeline:
    - name: Run test script
      runs: |
        EXPECTED_VERSION="${{package.version}}" ./test.sh
    - name: Check for missing dependancies
      uses: test/tw/ldd-check
      with:
        packages: ${{package.name}}
update:
  enabled: true
  github:
    identifier: seerr-team/seerr
    strip-prefix: v
